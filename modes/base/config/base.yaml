#config_version=5

mode:
  start_events:
    - cmd_start_mode_base
  stop_events:
    - cmd_stop_mode_base
  priority: 100

show_player:
  cmd_show_van_messaging:
    van_messaging:
      loops: 0

  ball_save_player_start_saving_ball:
    standard_ball_save:
      loops: 0

  ball_save_player_start_enabled:
    on:
      show_tokens:
        lights: l_shoot_again

  ball_save_player_start_disabled:
    off:
      show_tokens:
        lights: l_shoot_again

  ball_save_player_start_grace_period:
    off:
      show_tokens:
        lights: l_shoot_again

  ball_save_player_start_extended_saving_ball:
    standard_ball_save:
      loops: 0

  ball_save_player_start_extended_enabled:
    on:
      show_tokens:
        lights: l_shoot_again

  ball_save_player_start_extended_disabled:
    off:
      show_tokens:
        lights: l_shoot_again

  ball_save_player_start_extended_grace_period:
    off:
      show_tokens:
        lights: l_shoot_again

  ball_save_mystery_saving_ball:
    standard_ball_save:
      loops: 0

  cmd_flash_mode_light_grid_in_yer_face:
    fast_flash:
      action: play
      show_tokens:
        lights:
          grid_in_yer_face,
          van

  cmd_flash_mode_light_grid_fire:
    fast_flash:
      action: play
      show_tokens:
        lights:
          grid_fire,
          van

  cmd_flash_mode_light_grid_space_jam:
    fast_flash:
      action: play
      show_tokens:
        lights:
          grid_space_jam,
          van

  cmd_flash_mode_light_grid_rebound:
    fast_flash:
      action: play
      show_tokens:
        lights:
          grid_rebound,
          van

  cmd_flash_mode_light_grid_slam:
    fast_flash:
      action: play
      show_tokens:
        lights:
          grid_slam,
          van

  cmd_flash_mode_light_grid_fastbreak:
    fast_flash:
      action: play
      show_tokens:
        lights:
          grid_fastbreak,
          van

  cmd_flash_van_for_eject:
    super_fast_flash:
      action: play
      show_tokens:
        lights:
          van

  cmd_stop_flash_van_for_eject:
    super_fast_flash:
      action: stop
      show_tokens:
        lights:
          van

  cmd_pulse_mode_light:
    med_flash:
      action: play
      show_tokens:
        light: (current_player.v_active_mode_light)

  cmd_stop_flash_mode_lights:
    med_flash:
      action: stop
      show_tokens:
        lights:
          - grid_in_yer_face
          - grid_fire
          - grid_space_jam
          - grid_rebound
          - grid_slam
          - grid_fastbreak
    fast_flash:
      action: stop
      show_tokens:
        lights:
          - grid_in_yer_face
          - grid_fire
          - grid_space_jam
          - grid_rebound
          - grid_slam
          - grid_fastbreak
          - van
    van_flash:
      action: stop

sound_player:
  cmd_start_shoot_the_van:
    shoot_the_van:
      action: play
      loops: 0
      volume: 0.8
  cmd_play_van_eject_vuk_sound:
    van_vuk_out_long:
      action: play
      loops: 0
      volume: 0.8
      events_when_about_to_finish:
        - cmd_release_all_bh_van
        - cmd_release_all_bh_mode_van
        - cmd_stop_flash_van_for_eject
      about_to_finish_time: 1.5s

ball_saves:
  player_start:
    active_time: 10s
    enable_events: cmd_playfield_initiated
    auto_launch: yes
    balls_to_save: 1
    grace_period: 5s
    eject_delay: 3.2s
  player_start_extended:
    active_time: 25s
    enable_events: cmd_enable_player_start_extended_ball_save
    auto_launch: yes
    balls_to_save: 1
    grace_period: 5s
    eject_delay: 3.2s
  mystery:
    active_time: 30s
    enable_events: cmd_mystery_start_30_second_ball_save
    auto_launch: yes
    balls_to_save: -1
    grace_period: 5s
    eject_delay: 3.2s
  multiball_start:
    active_time: 20s
    enable_events: mode_escape_multiball_started
    auto_launch: yes
    balls_to_save: -1
    grace_period: 5s

slides:
  tilt_warning_0:
    widgets:
      - type: image
        image: warning_1v1
    expire: 1.8s

  tilt_slide:
    - type: text
      text: "TILTING!!!"
      style: big
      round_anchor_x: left
      anchor_y: bottom
      y: 21


# test start


# test end

slide_player:
  cmd_start_shoot_the_van:
    chainsaw_shoot_the_van_slide:
      priority: 500
      expire: 4.6s
  tilt_warning_0:
    tilt_warning_0:
      priority: 100000

## test start

#  s_right_flipper_active:
#    finalbattle_hitchhiker_fight:
#      priority: 40000

# test end


##################################################
# Shots
##################################################

shots:
  top_turbo_bumper:
    switch: s_top_turbo_bumper
  left_turbo_bumper:
    switch: s_left_turbo_bumper
  right_turbo_bumper:
    switch: s_right_turbo_bumper
  right_slingshot:
    switch: s_right_slingshot
  left_slingshot:
    switch: s_left_slingshot

##################################################
# Devices
##################################################

ball_holds:
  bh_mode_van:
    balls_to_hold: 1
    hold_devices: bd_van
    reset_events: cmd_reset_bh_mode_van
    enable_events: cmd_enable_bh_mode_van
    disable_events: cmd_disable_bh_mode_van
    release_all_events: cmd_release_all_bh_mode_van

variable_player:

  ########################################
  # Score
  ########################################

  ## combo ##

  cmd_combo_score:
    score: 10000 * current_player.v_combo_combo_multiplier

  ## skill shot ##

  cmd_skill_shot_score_lock:
    score: 15000 * current_player.v_playfield_multiplier
  cmd_skill_shot_score_success:
    score: 50000 * current_player.v_playfield_multiplier

  ## pop bumpers ##

  cmd_score_pop_bumper:
    score: 5330 * current_player.v_playfield_multiplier
  cmd_score_complete_mystery_meat:
    score: 250000 * current_player.v_playfield_multiplier

  left_slingshot_hit:
    score: 2550 * current_player.v_playfield_multiplier
  right_slingshot_hit:
    score: 2550 * current_player.v_playfield_multiplier
  magnavuk_shot_left:
    score: 100000 * current_player.v_playfield_multiplier
  magnavuk_shot_right:
    score: 100000 * current_player.v_playfield_multiplier

  ## chainsaw ##

  cmd_score_chainsaw_letter:
    score: 5000 * current_player.v_playfield_multiplier
  cmd_score_chainsaw_rev:
    score: 5330 * current_player.v_playfield_multiplier
  cmd_chainsaw_score_jackpot{current_player.v_chainsaw_jackpot_count==1 and current_player.v_cs_multiball_completion_counter_count==0}:
    score: 200000 * current_player.v_playfield_multiplier
  cmd_chainsaw_score_jackpot{current_player.v_chainsaw_jackpot_count==2 and current_player.v_cs_multiball_completion_counter_count==0}:
    score: 250000 * current_player.v_playfield_multiplier
  cmd_chainsaw_score_jackpot{current_player.v_chainsaw_jackpot_count==3 and current_player.v_cs_multiball_completion_counter_count==0}:
    score: 300000 * current_player.v_playfield_multiplier
  cmd_chainsaw_score_jackpot{current_player.v_chainsaw_jackpot_count==4 and current_player.v_cs_multiball_completion_counter_count==0}:
    score: 350000 * current_player.v_playfield_multiplier
  cmd_chainsaw_score_jackpot{current_player.v_chainsaw_jackpot_count==5 and current_player.v_cs_multiball_completion_counter_count==0}:
    score: 400000 * current_player.v_playfield_multiplier
  cmd_chainsaw_score_jackpot{current_player.v_chainsaw_jackpot_count==6 and current_player.v_cs_multiball_completion_counter_count==0}:
    score: 750000 * current_player.v_playfield_multiplier
  cmd_score_chainsaw_super_jackpot{current_player.v_cs_multiball_completion_counter_count==0}:
    score: 1000000 * current_player.v_playfield_multiplier

  cmd_chainsaw_score_jackpot{current_player.v_chainsaw_jackpot_count==1 and current_player.v_cs_multiball_completion_counter_count==1}:
    score: 300000 * current_player.v_playfield_multiplier
  cmd_chainsaw_score_jackpot{current_player.v_chainsaw_jackpot_count==2 and current_player.v_cs_multiball_completion_counter_count==1}:
    score: 350000 * current_player.v_playfield_multiplier
  cmd_chainsaw_score_jackpot{current_player.v_chainsaw_jackpot_count==3 and current_player.v_cs_multiball_completion_counter_count==1}:
    score: 400000 * current_player.v_playfield_multiplier
  cmd_chainsaw_score_jackpot{current_player.v_chainsaw_jackpot_count==4 and current_player.v_cs_multiball_completion_counter_count==1}:
    score: 450000 * current_player.v_playfield_multiplier
  cmd_chainsaw_score_jackpot{current_player.v_chainsaw_jackpot_count==5 and current_player.v_cs_multiball_completion_counter_count==1}:
    score: 500000 * current_player.v_playfield_multiplier
  cmd_chainsaw_score_jackpot{current_player.v_chainsaw_jackpot_count==6 and current_player.v_cs_multiball_completion_counter_count==1}:
    score: 1000000 * current_player.v_playfield_multiplier
  cmd_score_chainsaw_super_jackpot{current_player.v_cs_multiball_completion_counter_count==1}:
    score: 1500000 * current_player.v_playfield_multiplier

  cmd_chainsaw_score_jackpot{current_player.v_chainsaw_jackpot_count==1 and current_player.v_cs_multiball_completion_counter_count>1}:
    score: 500000 * current_player.v_playfield_multiplier
  cmd_chainsaw_score_jackpot{current_player.v_chainsaw_jackpot_count==2 and current_player.v_cs_multiball_completion_counter_count>1}:
    score: 500000 * current_player.v_playfield_multiplier
  cmd_chainsaw_score_jackpot{current_player.v_chainsaw_jackpot_count==3 and current_player.v_cs_multiball_completion_counter_count>1}:
    score: 500000 * current_player.v_playfield_multiplier
  cmd_chainsaw_score_jackpot{current_player.v_chainsaw_jackpot_count==4 and current_player.v_cs_multiball_completion_counter_count>1}:
    score: 500000 * current_player.v_playfield_multiplier
  cmd_chainsaw_score_jackpot{current_player.v_chainsaw_jackpot_count==5 and current_player.v_cs_multiball_completion_counter_count>1}:
    score: 500000 * current_player.v_playfield_multiplier
  cmd_chainsaw_score_jackpot{current_player.v_chainsaw_jackpot_count==6 and current_player.v_cs_multiball_completion_counter_count>1}:
    score: 500000 * current_player.v_playfield_multiplier
  cmd_score_chainsaw_super_jackpot{current_player.v_cs_multiball_completion_counter_count>1}:
    score: 3000000 * current_player.v_playfield_multiplier

  ## franklin ##

  logicblock_left_franklin_counter_hit{count==1}:
    score: 10000 * current_player.v_playfield_multiplier
  logicblock_left_franklin_counter_hit{count==2}:
    score: 20000 * current_player.v_playfield_multiplier
  logicblock_left_franklin_counter_hit{count==3}:
    score: 30000 * current_player.v_playfield_multiplier
  logicblock_left_franklin_counter_hit{count==4}:
    score: 40000 * current_player.v_playfield_multiplier
  logicblock_right_franklin_counter_hit{count==1}:
    score: 10000 * current_player.v_playfield_multiplier
  logicblock_right_franklin_counter_hit{count==2}:
    score: 20000 * current_player.v_playfield_multiplier
  logicblock_right_franklin_counter_hit{count==3}:
    score: 30000 * current_player.v_playfield_multiplier
  logicblock_right_franklin_counter_hit{count==4}:
    score: 40000 * current_player.v_playfield_multiplier
  franklin_letters_collected:
    score: 200000 * current_player.v_playfield_multiplier

  ## franklin frenzy ##

  cmd_score_franklin_frenzy_switch:
    score: 5000 * current_player.v_playfield_multiplier
  cmd_score_franklin_millions:
    score: current_player.v_franklin_millions_score * current_player.v_playfield_multiplier

  ## meathook ##

  cmd_score_meathook{current_player.v_meathook_total<machine.meathook_total_for_reward_1}:
    score: 15000 * current_player.v_playfield_multiplier
  cmd_score_meathook{current_player.v_meathook_total>=machine.meathook_total_for_reward_1}:
    score: 25000 * current_player.v_playfield_multiplier

  ## Escape ##

  cmd_score_lock_target_hit:
    score: 10000 * current_player.v_playfield_multiplier
  cmd_score_ball_1_lock:
    score: 25000 * current_player.v_playfield_multiplier
  cmd_score_ball_2_lock:
    score: 50000 * current_player.v_playfield_multiplier
  cmd_score_ball_3_lock:
    score: 100000 * current_player.v_playfield_multiplier

  ## Escape Multiball ##

  cmd_escape_score_kids_safe:
    score: 50000 * current_player.v_current_escape_multiplier * current_player.v_playfield_multiplier
  cmd_escape_score_jackpot:
    score: current_player.v_captive_jackpot_score * current_player.v_current_escape_multiplier * current_player.v_playfield_multiplier
  cmd_escape_score_super_jackpot:
    score: 750000 * current_player.v_current_escape_multiplier * current_player.v_playfield_multiplier

  ## mystery awards ##

  cmd_mystery_choice{choice=="small_points"}:
    score: 10000 * current_player.v_playfield_multiplier
  cmd_mystery_choice{choice=="big_points"}:
    score: 2000000 * current_player.v_playfield_multiplier

  ## mask ##

  cmd_mask_score_letter_hit:
    score: current_player.v_mask_letter_score * current_player.v_playfield_multiplier
  cmd_mask_score_complete_hit:
    score: current_player.v_mask_complete_score * current_player.v_playfield_multiplier

  ## general ##

  s_slaughter_house_target_active:
    score: 5330 * current_player.v_playfield_multiplier
  s_left_outlane_active:
    score: 5330 * current_player.v_playfield_multiplier
  s_left_return_lane_active:
    score: 5330 * current_player.v_playfield_multiplier
  s_right_outlane_active:
    score: 5330 * current_player.v_playfield_multiplier
  s_right_return_lane_active:
    score: 5330 * current_player.v_playfield_multiplier

  ## graveyard multiplier ##

  cmd_tt_score_1:
    score: 10000 * current_player.v_playfield_multiplier
  cmd_tt_score_2:
    score: 20000 * current_player.v_playfield_multiplier
  cmd_tt_score_3:
    score: 30000 * current_player.v_playfield_multiplier
  cmd_tt_score_4:
    score: 50000 * current_player.v_playfield_multiplier


  ## drop targets ##

  drop_target_v_down:
    score: 10000 * current_player.v_playfield_multiplier
  drop_target_a_down:
    score: 10000 * current_player.v_playfield_multiplier
  drop_target_n_down:
    score: 10000 * current_player.v_playfield_multiplier

  ## van/modes ##

  cmd_score_start_mode:
    score: 15000 * current_player.v_playfield_multiplier
  cmd_score_idle_van:
    score: 35 * current_player.v_playfield_multiplier

  ## extra ball ##

  cmd_score_extra_ball:
    score: 250000 * current_player.v_playfield_multiplier

  ## hitchhiker ##

  cmd_hitchhiker_score_orbits:
    score: 250000 * current_player.v_playfield_multiplier
  cmd_hitchhiker_score_van_1:
    score: 500000 * current_player.v_playfield_multiplier
  cmd_hitchhiker_score_ramp:
    score: 250000 * current_player.v_playfield_multiplier
  cmd_hitchhiker_score_van_2:
    score: 750000 * current_player.v_playfield_multiplier
  cmd_hitchhiker_score_target:
    score: 250000 * current_player.v_playfield_multiplier
  cmd_hitchhiker_score_van_3:
    score: 1000000 * current_player.v_playfield_multiplier

  ## barbecue ##

  cmd_barbecue_score_1:
    score: 200000 * current_player.v_playfield_multiplier
  cmd_barbecue_score_2:
    score: 300000 * current_player.v_playfield_multiplier
  cmd_barbecue_score_3:
    score: 500000 * current_player.v_playfield_multiplier
  cmd_barbecue_score_4:
    score: 750000 * current_player.v_playfield_multiplier
  cmd_barbecue_score_5:
    score: 1500000 * current_player.v_playfield_multiplier

  ## grandpa ##

  cmd_grandpa_score_right_ramp:
    score: 25000 * current_player.v_playfield_multiplier
  cmd_grandpa_score_left_ramp_1:
    score: 250000 * current_player.v_playfield_multiplier
  cmd_grandpa_score_left_ramp_2:
    score: 500000 * current_player.v_playfield_multiplier
  cmd_grandpa_score_left_ramp_3:
    score: 1500000 * current_player.v_playfield_multiplier

  ## sally ##

  cmd_sally_score_pop_bumper:
    score: 25000 * current_player.v_playfield_multiplier
  cmd_sally_score_wiggle:
    score: 250000 * current_player.v_playfield_multiplier
  cmd_sally_score_hand_free:
    score: 500000 * current_player.v_playfield_multiplier
  cmd_sally_score_escape:
    score: 1000000 * current_player.v_playfield_multiplier

  ## sawemall ##

  cmd_sawemall_score_targets:
    score: 100000 * current_player.v_playfield_multiplier
  cmd_sawemall_score_van_1:
    score: 250000 * current_player.v_playfield_multiplier
  cmd_sawemall_score_van_2:
    score: 500000 * current_player.v_playfield_multiplier
  cmd_sawemall_score_van_3:
    score: 750000 * current_player.v_playfield_multiplier
  cmd_sawemall_score_van_4:
    score: 1000000 * current_player.v_playfield_multiplier

  ########################################
  # Van Vuk
  ########################################

  cmd_set_van_messaging_on:
    v_enable_van_messaging:
      action: set
      int: 1

  cmd_set_van_messaging_off:
    v_enable_van_messaging:
      action: set
      int: 0

  ########################################
  # Bonus
  ########################################

  cmd_add_meathook_bonus:
    meathook_bonus: 1
  cmd_add_franklin_bonus:
    franklin_bonus: 1
  cmd_add_combo_bonus:
    combo_bonus: 1
  cmd_add_mode_bonus:
    mode_bonus: 1

  ########################################
  # Diverter
  ########################################

  cmd_enable_diverter:
    v_diverter_is_active:
      action: set
      int: 1
  cmd_disable_diverter:
    v_diverter_is_active:
      action: set
      int: 0

  ########################################
  # Ball Save
  ########################################
  
  mode_base_started:
    v_initial_playfield_active_fired:
      action: set
      int: 0
  cmd_playfield_initiated:
    v_initial_playfield_active_fired:
      action: set
      int: 1


  ########################################
  # Universal Variable Player
  ########################################

  # It keeps turning off the main animation during multiball so I have this garbage hack
  cmd_start_mode_escape_multiball:
    v_play_help_animation:
      action: set
      int: 0
  cmd_stop_mode_escape_multiball:
    v_play_help_animation:
      action: set
      int: 1

  ########################################
  # Testing
  ########################################

#  s_left_flipper_active:
#    v_finalbattle_hitchhiker_damage: current_player.v_finalbattle_damage
#
#  player_v_finalbattle_hitchhiker_damage:
#    v_finalbattle_hitchhiker_width:
#      action: set
#      float: current_player.v_finalbattle_hitchhiker_damage / current_player.v_finalbattle_hitchhiker_damage_total * 128.0

#  s_right_flipper_active:
#    v_diverter_is_active:
#      action: set
#      int: 1

event_player:

  ########################################
  # Start Base Mode
  ########################################

#  mode_base_started:
#    - cmd_enable_light_van_message

  ########################################
  # Start Ball
  ########################################

  ball_started:
    - cmd_enable_mode_switcher_and_message

  ########################################
  # Van VUK
  ########################################

  # Van VUK events:
  #
  # - event: cmd_disable_bh_mode_van
  # - state: disabled
  # - behavior: Shoots the ball out automatically
  #
  # - event: cmd_enable_bh_mode_van
  # - state: enabled
  # - behavior: Need to handle the clearing of the VUK manually
  #
  # - event: cmd_release_all_bh_mode_van
  # - state: releasing
  # - behavior: Ejects the ball

  # enable message then trigger mode switcher
  # the mode switcher will conditionally turn off message as needed
  cmd_enable_mode_switcher_and_message:
    - cmd_enable_light_van_message
    - cmd_enable_mode_switcher

  cmd_enable_light_van_message:
    - cmd_enable_bh_mode_van
    - cmd_set_van_messaging_on

  cmd_disable_light_van_message:
    - cmd_set_van_messaging_off

  # Show the van messaging when and eject the ball
  ball_hold_bh_mode_van_full{current_player.v_enable_van_messaging==1}:
    - cmd_score_idle_van
    - cmd_eject_van_vuk_with_audio
    - cmd_show_van_messaging

  # only used this if you're not using the van ball hold like chainsaw multiball
  cmd_disable_mode_switcher_and_message:
    - cmd_disable_mode_switcher
    - cmd_disable_light_van_message

  ########################################
  # Chainsaw Multiball
  ########################################

  cmd_start_chainsaw_multiball:
    - cmd_disable_progressive_passive_modes__chainsaw_mode
  cmd_chainsaw_multiball_ended:
    - cmd_enable_progressive_passive_modes

  ########################################
  # Diverter
  ########################################
 
  s_right_ramp_exit_active{current_player.v_diverter_is_active==1}:
    - cmd_activate_diverter
    - cmd_disable_diverter
  s_right_ramp_exit_active{current_player.v_diverter_is_active==0}:
    - cmd_deactivate_diverter

  ########################################
  # Playfield
  ########################################
  
  cmd_playfield_active{current_player.v_initial_playfield_active_fired==0}:
    - cmd_playfield_initiated

#  Disabling because the reset would clear the skillshot
#  s_3_bank_drop_bottom_active:
#    - cmd_playfield_active
#  s_3_bank_drop_mid_active:
#    - cmd_playfield_active
#  s_3_bank_drop_top_active:
#    - cmd_playfield_active
  s_right_ramp_enter_active:
    - cmd_playfield_active
  s_right_ramp_exit_active:
    - cmd_playfield_active
  s_captive_ball_target_active:
    - cmd_playfield_active
  s_top_basket_enter_active:
    - cmd_playfield_active
  s_top_basket_made_active:
    - cmd_playfield_active
  s_right_ramp_s_u_left_active:
    - cmd_playfield_active
  s_right_ramp_s_u_right_active:
    - cmd_playfield_active
  s_chain_target_c_active:
    - cmd_playfield_active
  s_chain_target_h_active:
    - cmd_playfield_active
  s_chain_target_a_active:
    - cmd_playfield_active
  s_chain_target_i_active:
    - cmd_playfield_active
  s_chain_target_n_active:
    - cmd_playfield_active
  s_saw_target_s_active:
    - cmd_playfield_active
  s_saw_target_a_active:
    - cmd_playfield_active
  s_saw_target_w_active:
    - cmd_playfield_active
  s_super_duper_jackpot_active:
    - cmd_playfield_active
  s_slaughter_house_target_active:
    - cmd_playfield_active
  s_right_orbit_top_active:
    - cmd_playfield_active
  s_right_orbit_bottom_active:
    - cmd_playfield_active
  s_jump_ball_vuk_active:
    - cmd_playfield_active
  s_van_vuk_active:
    - cmd_playfield_active
  s_left_orbit_bottom_active:
    - cmd_playfield_active
  s_left_orbit_top_active:
    - cmd_playfield_active
  s_top_turbo_bumper_active:
    - cmd_playfield_active
  s_left_turbo_bumper_active:
    - cmd_playfield_active
  s_right_turbo_bumper_active:
    - cmd_playfield_active
  s_left_outlane_active:
    - cmd_playfield_active
  s_left_return_lane_active:
    - cmd_playfield_active
  s_left_slingshot_active:
    - cmd_playfield_active
  s_right_outlane_active:
    - cmd_playfield_active
  s_right_return_lane_active:
    - cmd_playfield_active
  s_right_slingshot_active:
    - cmd_playfield_active

  ########################################
  # Ball Save Extended
  ########################################

  cmd_super_skill_shot_award_ball_save:
    cmd_enable_player_start_extended_ball_save:

  ########################################
  # Van Eject
  ########################################

  cmd_eject_van_vuk_with_audio:
    - cmd_play_van_eject_vuk_sound
    - cmd_flash_van_for_eject

  ########################################
  # Testing
  ########################################

#  s_right_flipper_active:
#    - cmd_test_flipper_right
#  s_left_flipper_active:
#    - cmd_test_flipper_left

#timers:
#
#  my_test_timer:
#    start_value: 0
#    end_value: 1
#    start_running: true

