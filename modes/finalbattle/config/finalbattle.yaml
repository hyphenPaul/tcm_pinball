#config_version=5

mode:
  start_events:
    - cmd_start_mode_finalbattle
  stop_events:
    - cmd_stop_mode_finalbattle
  priority: 10000

##################################################
# Events
##################################################

event_player:

  mode_finalbattle_started:
    cmd_mode_intro_started:
    cmd_disable_bh_mode_van:
    cmd_finalbattle_set_state_starting:
    cmd_finalbattle_start_intro_slide:
    # sean - add this
    #cmd_finalbattle_start_intro_slide_sound:

  slide_finalbattle_intro_slide_removed:
    # sean - remove this
    cmd_eject_van_vuk_with_audio:
    cmd_finalbattle_after_intro_complete:

  cmd_finalbattle_after_intro_complete:
    cmd_finalbattle_set_state_phase_1:
    cmd_finalbattle_phase_1_timer_start:
    cmd_finalbattle_enable_phase_1_gimme_ball_save:
    cmd_play_finalbattle_bg_music_phase_1:
    cmd_finalbattle_start_collect_weapons_slide:
    cmd_finalbattle_refresh_lights:

  timer_finalbattle_phase_1_timer_complete:
    cmd_stop_finalbattle_music_phase_1:
    cmd_finalbattle_play_bass_hit:
    cmd_finalbattle_play_bonus_bg:
    cmd_finalbattle_enable_phase_1_ball_save:
    cmd_finalbattle_set_state_phase_2:
    cmd_finalbattle_refresh_lights:
    cmd_disable_flippers:
    cmd_finalbattle_play_completion_slides:
    cmd_remove_finalbattle_start_collect_weapons_slide:
    cmd_finalbattle_show_initial_bonus_slide:
    #cmd_stop_finalbattle_mode:

  cmd_finalbattle_bonus_slides_complete:
    cmd_finalbattle_start_multiball_intro_slide:

  slide_finalbattle_multiball_intro_slide_removed:
    cmd_enable_flippers:
    cmd_finalbattle_eject_ball_save:
    cmd_finalbattle_start_multiball:

  cmd_finalbattle_start_multiball:
    cmd_finalbattle_start_final_multiball:
    cmd_start_sawyer:
    # Sean - comment out above and uncomment out below to start leatherface
    #slide_finalbattle_hitchhiker_death_removed:

  cmd_start_sawyer:
    cmd_finalbattle_set_state_multiball_sawyer:
    cmd_finalbattle_refresh_lights:
    cmd_show_sawyer_slide:

  player_v_finalbattle_sawyer_damage{current_player.v_finalbattle_sawyer_damage>=current_player.v_finalbattle_sawyer_damage_total}:
    cmd_finalbattle_set_state_sawyer_final_blow:
    cmd_finalbattle_refresh_lights:
    cmd_remove_sawyer_slide:
    cmd_show_sawyer_final_blow_slide:

  cmd_finalbattle_kill_sawyer:
    cmd_remove_sawyer_final_blow_slide:
    cmd_finalbattle_play_death_sound_sawyer:
    cmd_show_sawyer_death_slide:

  slide_finalbattle_sawyer_death_removed:
    cmd_finalbattle_maybe_add_ball:
    cmd_finalbattle_set_state_multiball_grandpa:
    cmd_finalbattle_refresh_lights:
    cmd_show_grandpa_slide:

  player_v_finalbattle_grandpa_damage{current_player.v_finalbattle_grandpa_damage>=current_player.v_finalbattle_grandpa_damage_total}:
    cmd_finalbattle_set_state_grandpa_final_blow:
    cmd_finalbattle_refresh_lights:
    cmd_remove_grandpa_slide:
    cmd_show_grandpa_final_blow_slide:

  cmd_finalbattle_kill_grandpa:
    cmd_remove_sawyer_final_blow_slide:
    cmd_finalbattle_play_death_sound_grandpa:
    cmd_show_grandpa_death_slide:

  slide_finalbattle_grandpa_death_removed:
    cmd_finalbattle_maybe_add_ball:
    cmd_finalbattle_reset_combo_values:
    cmd_finalbattle_set_state_multiball_hitchhiker:
    cmd_finalbattle_refresh_lights:
    cmd_show_hitchhiker_slide:

  player_v_finalbattle_hitchhiker_damage{current_player.v_finalbattle_hitchhiker_damage>=current_player.v_finalbattle_hitchhiker_damage_total}:
    cmd_finalbattle_set_state_hitchhiker_final_blow:
    cmd_finalbattle_refresh_lights:
    cmd_remove_hitchhiker_slide:
    cmd_show_hitchhiker_final_blow_slide:

  cmd_finalbattle_kill_hitchhiker:
    cmd_remove_sawyer_final_blow_slide:
    cmd_finalbattle_play_death_sound_hitchhiker:
    cmd_show_hitchhiker_death_slide:

  slide_finalbattle_hitchhiker_death_removed:
    cmd_finalbattle_maybe_add_ball:
    cmd_finalbattle_reset_combo_values:
    cmd_finalbattle_set_state_multiball_leatherface:
    cmd_finalbattle_refresh_lights:
    cmd_show_leatherface_slide:

  cmd_finalbattle_check_leatherface_combo_phase{current_player.v_finalbattle_combo_left_orbit==1 and current_player.v_finalbattle_combo_captive==1 and current_player.v_finalbattle_combo_left_ramp==1 and current_player.v_finalbattle_combo_slaughter==1 and current_player.v_finalbattle_combo_right_ramp==1 and current_player.v_finalbattle_combo_right_orbit==1}:
    cmd_finalbattle_set_state_leatherface_roaming:
    cmd_finalbattle_refresh_lights:
    cmd_finalbattle_roaming_timer_restart:
    cmd_remove_leatherface_slide:
    cmd_show_leatherface_roaming:

  player_v_finalbattle_leatherface_roaming_shot:
    cmd_finalbattle_refresh_lights:

  cmd_finalbattle_leatherface_roaming_hit:
    cmd_finalbattle_roaming_timer_stop:
    cmd_finalbattle_set_state_leatherface_final_blow:
    cmd_show_leatherface_final_blow_slide:
    cmd_remove_leatherface_roaming:
    cmd_enable_bh_mode_van:
    cmd_finalbattle_refresh_lights:

  ball_hold_bh_mode_van_full{current_player.v_finalbattle_state=="leatherface_final_blow"}:
    cmd_finalbattle_kill_leatherface:

  cmd_finalbattle_kill_leatherface:
    cmd_finalbattle_set_state_leatherface_dead:
    cmd_disable_flippers:
    cmd_disable_bh_mode_van:
    cmd_finalbattle_refresh_lights:
    cmd_remove_leatherface_final_blow_slide:
    cmd_finalbattle_play_death_sound_leatherface:
    cmd_show_leatherface_death_slide:

  slide_finalbattle_leatherface_death_removed:
    cmd_enable_flippers:
    cmd_eject_van_vuk_with_audio:
    cmd_stop_finalbattle_mode:

  ## add a ball ##

  # Sean - manually calculate the ball count
  # Sean - This isn't going to work. Ball save on kill
  #cmd_finalbattle_maybe_add_ball{current_player.v_finalbattle_nunchucks_collected>0 and device.multiballs.final_multiball.balls_live_target<5}:
  cmd_finalbattle_maybe_add_ball{current_player.v_finalbattle_nunchucks_collected>0}:
    cmd_finalbattle_add_a_ball:

  ## shot events phase 1 ##

  # knife
  # extra damage points - tbd
  left_orbit_hit{current_player.v_finalbattle_state=="phase_1" and current_player.v_finalbattle_knife_collected==0}:
    cmd_finalbattle_set_knife_collected:
    cmd_finalbattle_start_knife_collect_slide:
    cmd_finalbattle_play_knife_collect_sound:
    cmd_finalbattle_refresh_lights:

  # nunchucks
  # add a ball on kills
  s_captive_ball_target_active{current_player.v_finalbattle_state=="phase_1" and current_player.v_finalbattle_nunchucks_collected==0}:
    cmd_finalbattle_set_nunchucks_collected:
    cmd_finalbattle_play_nunchucks_collect_sound:
    cmd_finalbattle_start_nunchucks_collect_slide:
    cmd_finalbattle_refresh_lights:

  # axe
  # 2 x kill jackpot - tbd
  left_ramp_hit{current_player.v_finalbattle_state=="phase_1" and current_player.v_finalbattle_axe_collected==0}:
    cmd_finalbattle_set_axe_collected:
    cmd_finalbattle_play_axe_collect_sound:
    cmd_finalbattle_start_axe_collect_slide:
    cmd_finalbattle_refresh_lights:

  # shotgun
  # extended ball save
  s_slaughter_house_target_active{current_player.v_finalbattle_state=="phase_1" and current_player.v_finalbattle_shotgun_collected==0}:
    cmd_finalbattle_set_shotgun_collected:
    cmd_finalbattle_extend_ball_save:
    cmd_finalbattle_play_shotgun_collect_sound:
    cmd_finalbattle_start_shotgun_collect_slide:
    cmd_finalbattle_refresh_lights:

  # flamethrower
  # double damage
  right_ramp_hit{current_player.v_finalbattle_state=="phase_1" and current_player.v_finalbattle_flamethrower_collected==0}:
    cmd_finalbattle_set_flamethrower_collected:
    cmd_finalbattle_set_damage_bonus: 
    cmd_finalbattle_play_flamethrower_collect_sound:
    cmd_finalbattle_start_flamethrower_collect_slide:
    cmd_finalbattle_refresh_lights:

  # chainsaw
  # chainsaw attack - tbd
  right_orbit_hit{current_player.v_finalbattle_state=="phase_1" and current_player.v_finalbattle_chainsaw_collected==0}:
    cmd_finalbattle_set_chainsaw_collected:
    cmd_finalbattle_play_chainsaw_collect_sound:
    cmd_finalbattle_start_chainsaw_collect_slide:
    cmd_finalbattle_refresh_lights:

  # shot events sawyer fight

  left_orbit_hit{current_player.v_finalbattle_state=="multiball_sawyer"}:
    cmd_damage_sawyer:
    cmd_finalbattle_play_hit_sound_sawyer:

  s_captive_ball_target_active{current_player.v_finalbattle_state=="multiball_sawyer"}:
    cmd_damage_sawyer:
    cmd_finalbattle_play_hit_sound_sawyer:

  left_ramp_hit{current_player.v_finalbattle_state=="multiball_sawyer"}:
    cmd_damage_sawyer:
    cmd_finalbattle_play_hit_sound_sawyer:

  s_slaughter_house_target_active{current_player.v_finalbattle_state=="multiball_sawyer"}:
    cmd_damage_sawyer:
    cmd_finalbattle_play_hit_sound_sawyer:

  right_ramp_hit{current_player.v_finalbattle_state=="multiball_sawyer"}:
    cmd_damage_sawyer:
    cmd_finalbattle_play_hit_sound_sawyer:

  right_orbit_hit{current_player.v_finalbattle_state=="multiball_sawyer"}:
    cmd_damage_sawyer:
    cmd_finalbattle_play_hit_sound_sawyer:

  s_super_duper_jackpot_active{current_player.v_finalbattle_state=="sawyer_final_blow"}:
    cmd_finalbattle_kill_sawyer:

  # shot events grandpa fight

  left_orbit_hit{current_player.v_finalbattle_state=="multiball_grandpa" and current_player.v_finalbattle_combo_left_orbit!=1}:
    cmd_damage_grandpa:
    cmd_finalbattle_play_hit_sound_grandpa:
    cmd_finalbattle_set_combo_left_orbit:
    cmd_finalbattle_combo_timer_restart:
    cmd_finalbattle_refresh_lights:

  s_captive_ball_target_active{current_player.v_finalbattle_state=="multiball_grandpa" and current_player.v_finalbattle_combo_captive!=1}:
    cmd_damage_grandpa:
    cmd_finalbattle_play_hit_sound_grandpa:
    cmd_finalbattle_set_combo_captive:
    cmd_finalbattle_combo_timer_restart:
    cmd_finalbattle_refresh_lights:

  left_ramp_hit{current_player.v_finalbattle_state=="multiball_grandpa" and current_player.v_finalbattle_combo_left_ramp!=1}:
    cmd_damage_grandpa:
    cmd_finalbattle_play_hit_sound_grandpa:
    cmd_finalbattle_set_combo_left_ramp:
    cmd_finalbattle_combo_timer_restart:
    cmd_finalbattle_refresh_lights:

  s_slaughter_house_target_active{current_player.v_finalbattle_state=="multiball_grandpa" and current_player.v_finalbattle_combo_slaughter!=1}:
    cmd_damage_grandpa:
    cmd_finalbattle_play_hit_sound_grandpa:
    cmd_finalbattle_set_combo_slaughter:
    cmd_finalbattle_combo_timer_restart:
    cmd_finalbattle_refresh_lights:

  right_ramp_hit{current_player.v_finalbattle_state=="multiball_grandpa" and current_player.v_finalbattle_combo_right_ramp!=1}:
    cmd_damage_grandpa:
    cmd_finalbattle_play_hit_sound_grandpa:
    cmd_finalbattle_set_combo_right_ramp:
    cmd_finalbattle_combo_timer_restart:
    cmd_finalbattle_refresh_lights:

  right_orbit_hit{current_player.v_finalbattle_state=="multiball_grandpa" and current_player.v_finalbattle_combo_right_orbit!=1}:
    cmd_damage_grandpa:
    cmd_finalbattle_play_hit_sound_grandpa:
    cmd_finalbattle_set_combo_right_orbit:
    cmd_finalbattle_combo_timer_restart:
    cmd_finalbattle_refresh_lights:

  s_super_duper_jackpot_active{current_player.v_finalbattle_state=="grandpa_final_blow"}:
    cmd_finalbattle_kill_grandpa:

  # shot events hitchhiker fight

  left_orbit_hit{current_player.v_finalbattle_state=="multiball_hitchhiker" and current_player.v_finalbattle_combo_left_orbit!=1}:
    cmd_damage_hitchhiker:
    cmd_finalbattle_play_hit_sound_hitchhiker:
    cmd_finalbattle_set_combo_left_orbit:
    cmd_finalbattle_combo_timer_restart:
    cmd_finalbattle_refresh_lights:

  s_captive_ball_target_active{current_player.v_finalbattle_state=="multiball_hitchhiker" and current_player.v_finalbattle_combo_captive!=1}:
    cmd_damage_hitchhiker:
    cmd_finalbattle_play_hit_sound_hitchhiker:
    cmd_finalbattle_set_combo_captive:
    cmd_finalbattle_combo_timer_restart:
    cmd_finalbattle_refresh_lights:

  left_ramp_hit{current_player.v_finalbattle_state=="multiball_hitchhiker" and current_player.v_finalbattle_combo_left_ramp!=1}:
    cmd_damage_hitchhiker:
    cmd_finalbattle_play_hit_sound_hitchhiker:
    cmd_finalbattle_set_combo_left_ramp:
    cmd_finalbattle_combo_timer_restart:
    cmd_finalbattle_refresh_lights:

  s_slaughter_house_target_active{current_player.v_finalbattle_state=="multiball_hitchhiker" and current_player.v_finalbattle_combo_slaughter!=1}:
    cmd_damage_hitchhiker:
    cmd_finalbattle_play_hit_sound_hitchhiker:
    cmd_finalbattle_set_combo_slaughter:
    cmd_finalbattle_combo_timer_restart:
    cmd_finalbattle_refresh_lights:

  right_ramp_hit{current_player.v_finalbattle_state=="multiball_hitchhiker" and current_player.v_finalbattle_combo_right_ramp!=1}:
    cmd_damage_hitchhiker:
    cmd_finalbattle_play_hit_sound_hitchhiker:
    cmd_finalbattle_set_combo_right_ramp:
    cmd_finalbattle_combo_timer_restart:
    cmd_finalbattle_refresh_lights:

  right_orbit_hit{current_player.v_finalbattle_state=="multiball_hitchhiker" and current_player.v_finalbattle_combo_right_orbit!=1}:
    cmd_damage_hitchhiker:
    cmd_finalbattle_play_hit_sound_hitchhiker:
    cmd_finalbattle_set_combo_right_orbit:
    cmd_finalbattle_combo_timer_restart:
    cmd_finalbattle_refresh_lights:

  s_super_duper_jackpot_active{current_player.v_finalbattle_state=="hitchhiker_final_blow"}:
    cmd_finalbattle_kill_hitchhiker:

  # shot events leatherface fight

  left_orbit_hit{current_player.v_finalbattle_state=="multiball_leatherface" and current_player.v_finalbattle_combo_left_orbit!=1}:
    cmd_damage_leatherface:
    cmd_finalbattle_play_hit_sound_leatherface:
    cmd_finalbattle_set_combo_left_orbit:
    cmd_finalbattle_refresh_lights:
    cmd_finalbattle_check_leatherface_combo_phase:

  s_captive_ball_target_active{current_player.v_finalbattle_state=="multiball_leatherface" and current_player.v_finalbattle_combo_captive!=1}:
    cmd_damage_leatherface:
    cmd_finalbattle_play_hit_sound_leatherface:
    cmd_finalbattle_set_combo_captive:
    cmd_finalbattle_refresh_lights:
    cmd_finalbattle_check_leatherface_combo_phase:

  left_ramp_hit{current_player.v_finalbattle_state=="multiball_leatherface" and current_player.v_finalbattle_combo_left_ramp!=1}:
    cmd_damage_leatherface:
    cmd_finalbattle_play_hit_sound_leatherface:
    cmd_finalbattle_set_combo_left_ramp:
    cmd_finalbattle_refresh_lights:
    cmd_finalbattle_check_leatherface_combo_phase:

  s_slaughter_house_target_active{current_player.v_finalbattle_state=="multiball_leatherface" and current_player.v_finalbattle_combo_slaughter!=1}:
    cmd_damage_leatherface:
    cmd_finalbattle_play_hit_sound_leatherface:
    cmd_finalbattle_set_combo_slaughter:
    cmd_finalbattle_refresh_lights:
    cmd_finalbattle_check_leatherface_combo_phase:

  right_ramp_hit{current_player.v_finalbattle_state=="multiball_leatherface" and current_player.v_finalbattle_combo_right_ramp!=1}:
    cmd_damage_leatherface:
    cmd_finalbattle_play_hit_sound_leatherface:
    cmd_finalbattle_set_combo_right_ramp:
    cmd_finalbattle_refresh_lights:
    cmd_finalbattle_check_leatherface_combo_phase:

  right_orbit_hit{current_player.v_finalbattle_state=="multiball_leatherface" and current_player.v_finalbattle_combo_right_orbit!=1}:
    cmd_damage_leatherface:
    cmd_finalbattle_play_hit_sound_leatherface:
    cmd_finalbattle_set_combo_right_orbit:
    cmd_finalbattle_refresh_lights:
    cmd_finalbattle_check_leatherface_combo_phase:

  left_orbit_hit{current_player.v_finalbattle_state=="leatherface_roaming" and current_player.v_finalbattle_leatherface_roaming_shot=="left_orbit"}:
    cmd_finalbattle_leatherface_roaming_hit:

  s_captive_ball_target_active{current_player.v_finalbattle_state=="leatherface_roaming" and v_finalbattle_leatherface_roaming_shot=="captive"}:
    cmd_finalbattle_leatherface_roaming_hit:

  left_ramp_hit{current_player.v_finalbattle_state=="leatherface_roaming" and v_finalbattle_leatherface_roaming_shot=="left_ramp"}:
    cmd_finalbattle_leatherface_roaming_hit:

  s_slaughter_house_target_active{current_player.v_finalbattle_state=="leatherface_roaming" and current_player.v_finalbattle_leatherface_roaming_shot=="slaughter"}:
    cmd_finalbattle_leatherface_roaming_hit:

  right_ramp_hit{current_player.v_finalbattle_state=="leatherface_roaming" and current_player.v_finalbattle_leatherface_roaming_shot=="right_ramp"}:
    cmd_finalbattle_leatherface_roaming_hit:

  right_orbit_hit{current_player.v_finalbattle_state=="leatherface_roaming" and current_player.v_finalbattle_leatherface_roaming_shot=="right_orbit"}:
    cmd_finalbattle_leatherface_roaming_hit:


  # combo events

  timer_finalbattle_combo_timer_complete:
    cmd_finalbattle_reset_combo_values:
    cmd_finalbattle_refresh_lights:

##################################################
# Logic
##################################################

timers:

  finalbattle_phase_1_timer:
    # Sean - reset this to 40
    start_value: 40
    #start_value: 10
    end_value: 0
    tick_interval: 1s
    direction: down
    start_running: False
    control_events:
      - event: cmd_finalbattle_phase_1_timer_stop
        action: stop
      - event: cmd_finalbattle_phase_1_timer_start
        action: start

  finalbattle_bonus_timer:
    start_value: 0
    end_value: 1000
    tick_interval: 2.5s
    direction: up
    start_running: False
    control_events:
      - event: cmd_finalbattle_bonus_timer_stop
        action: stop
      - event: cmd_finalbattle_bonus_timer_restart
        action: restart

  finalbattle_roaming_timer:
    start_value: 0
    end_value: 6
    tick_interval: 3s
    direction: up
    start_running: False
    restart_on_complete: True
    control_events:
      - event: cmd_finalbattle_roaming_timer_stop
        action: stop
      - event: cmd_finalbattle_roaming_timer_restart
        action: restart

  # grandpa timer

  finalbattle_combo_timer:
    start_value: 0
    end_value: 4
    tick_interval: 1s
    direction: up
    start_running: False
    control_events:
      - event: cmd_finalbattle_combo_timer_restart
        action: restart

ball_saves:

  finalbattle_phase_1_gimme:
    enable_events: cmd_finalbattle_enable_phase_1_gimme_ball_save
    disable_events: cmd_finalbattle_enable_phase_1_ball_save
    balls_to_save: -1
    auto_launch: yes

  finalbattle_phase_1:
    enable_events: cmd_finalbattle_enable_phase_1_ball_save
    auto_launch: false
    delayed_eject_events: cmd_finalbattle_eject_ball_save

##################################################
# Variables
##################################################

variable_player:

  cmd_finalbattle_set_state_starting:
    v_finalbattle_state:
      action: set
      string: "starting"

  cmd_finalbattle_set_state_phase_1:
    v_finalbattle_state:
      action: set
      string: "phase_1"

  cmd_finalbattle_set_state_phase_2:
    v_finalbattle_state:
      action: set
      string: "phase_2"

  cmd_finalbattle_set_state_multiball_sawyer:
    v_finalbattle_state:
      action: set
      string: "multiball_sawyer"

  cmd_finalbattle_set_state_sawyer_final_blow:
    v_finalbattle_state:
      action: set
      string: "sawyer_final_blow"

  cmd_finalbattle_set_state_multiball_grandpa:
    v_finalbattle_state:
      action: set
      string: "multiball_grandpa"

  cmd_finalbattle_set_state_grandpa_final_blow:
    v_finalbattle_state:
      action: set
      string: "grandpa_final_blow"

  cmd_finalbattle_set_state_multiball_hitchhiker:
    v_finalbattle_state:
      action: set
      string: "multiball_hitchhiker"

  cmd_finalbattle_set_state_hitchhiker_final_blow:
    v_finalbattle_state:
      action: set
      string: "hitchhiker_final_blow"

  cmd_finalbattle_set_state_multiball_leatherface:
    v_finalbattle_state:
      action: set
      string: "multiball_leatherface"

  cmd_finalbattle_set_state_leatherface_roaming:
    v_finalbattle_state:
      action: set
      string: "leatherface_roaming"

  cmd_finalbattle_set_state_leatherface_final_blow:
    v_finalbattle_state:
      action: set
      string: "leatherface_final_blow"

  cmd_finalbattle_set_state_leatherface_dead:
    v_finalbattle_state:
      action: set
      string: "leatherface_dead"

  timer_finalbattle_roaming_timer_tick{ticks==0}:
    v_finalbattle_leatherface_roaming_shot:
      action: set
      string: "left_orbit"

  timer_finalbattle_roaming_timer_tick{ticks==1}:
    v_finalbattle_leatherface_roaming_shot:
      action: set
      string: "captive"

  timer_finalbattle_roaming_timer_tick{ticks==2}:
    v_finalbattle_leatherface_roaming_shot:
      action: set
      string: "left_ramp"

  timer_finalbattle_roaming_timer_tick{ticks==3}:
    v_finalbattle_leatherface_roaming_shot:
      action: set
      string: "slaughter"

  timer_finalbattle_roaming_timer_tick{ticks==4}:
    v_finalbattle_leatherface_roaming_shot:
      action: set
      string: "right_ramp"

  timer_finalbattle_roaming_timer_tick{ticks==5}:
    v_finalbattle_leatherface_roaming_shot:
      action: set
      string: "right_orbit"

  ## shot variables ##

  cmd_finalbattle_set_knife_collected:
    v_finalbattle_knife_collected:
      action: set
      int: 1

  cmd_finalbattle_set_damage_bonus:
    v_finalbattle_damage_bonus:
      action: set
      float: 15

  cmd_finalbattle_set_nunchucks_collected:
    v_finalbattle_nunchucks_collected:
      action: set
      int: 1

  cmd_finalbattle_set_axe_collected:
    v_finalbattle_axe_collected:
      action: set
      int: 1

  cmd_finalbattle_set_shotgun_collected:
    v_finalbattle_shotgun_collected:
      action: set
      int: 1

  cmd_finalbattle_extend_ball_save:
    v_finalbattle_ball_save_extention:
      action: set
      int: 15000

  cmd_finalbattle_set_flamethrower_collected:
    v_finalbattle_flamethrower_collected:
      action: set
      int: 1

  cmd_finalbattle_set_chainsaw_collected:
    v_finalbattle_chainsaw_collected:
      action: set
      int: 1

  ## combo variables ##

  cmd_finalbattle_reset_combo_values.1:
    v_finalbattle_combo_left_orbit:
      action: set
      int: 0

  cmd_finalbattle_reset_combo_values.2:
    v_finalbattle_combo_captive:
      action: set
      int: 0

  cmd_finalbattle_reset_combo_values.3:
    v_finalbattle_combo_left_ramp:
      action: set
      int: 0

  cmd_finalbattle_reset_combo_values.4:
    v_finalbattle_combo_slaughter:
      action: set
      int: 0

  cmd_finalbattle_reset_combo_values.5:
    v_finalbattle_combo_right_ramp:
      action: set
      int: 0

  cmd_finalbattle_reset_combo_values.6:
    v_finalbattle_combo_right_orbit:
      action: set
      int: 0

  cmd_finalbattle_reset_combo_values.7:
    v_finalbattle_combo_multiplier:
      action: set
      int: 1

  cmd_finalbattle_inc_combo_multiplier:
    v_finalbattle_combo_multiplier: 1

  cmd_finalbattle_set_combo_left_orbit:
    v_finalbattle_combo_left_orbit:
      action: set
      int: 1

  cmd_finalbattle_set_combo_captive:
    v_finalbattle_combo_captive:
      action: set
      int: 1

  cmd_finalbattle_set_combo_left_ramp:
    v_finalbattle_combo_left_ramp:
      action: set
      int: 1

  cmd_finalbattle_set_combo_slaughter:
    v_finalbattle_combo_slaughter:
      action: set
      int: 1

  cmd_finalbattle_set_combo_right_ramp:
    v_finalbattle_combo_right_ramp:
      action: set
      int: 1

  cmd_finalbattle_set_combo_right_orbit:
    v_finalbattle_combo_right_orbit:
      action: set
      int: 1

  ## fight variables ##

  cmd_damage_sawyer:
    v_finalbattle_sawyer_damage: current_player.v_finalbattle_damage + current_player.v_finalbattle_damage_bonus

  player_v_finalbattle_sawyer_damage:
    v_finalbattle_sawyer_width:
      action: set
      float: current_player.v_finalbattle_sawyer_damage / current_player.v_finalbattle_sawyer_damage_total * 50.0

  cmd_damage_grandpa:
    v_finalbattle_grandpa_damage: current_player.v_finalbattle_damage + current_player.v_finalbattle_damage_bonus

  player_v_finalbattle_grandpa_damage:
    v_finalbattle_grandpa_width:
      action: set
      float: current_player.v_finalbattle_grandpa_damage / current_player.v_finalbattle_grandpa_damage_total * 50.0

  cmd_damage_hitchhiker:
    v_finalbattle_hitchhiker_damage: current_player.v_finalbattle_damage + current_player.v_finalbattle_damage_bonus

  player_v_finalbattle_hitchhiker_damage:
    v_finalbattle_hitchhiker_width:
      action: set
      float: current_player.v_finalbattle_hitchhiker_damage / current_player.v_finalbattle_hitchhiker_damage_total * 50.0

  # Hardcode to 15 to make sure the width is complete when all shots are shot
  cmd_damage_leatherface:
    v_finalbattle_leatherface_damage: 15

  player_v_finalbattle_leatherface_damage:
    v_finalbattle_leatherface_width:
      action: set
      float: current_player.v_finalbattle_leatherface_damage / current_player.v_finalbattle_leatherface_damage_total * 50.0

##################################################
# Devices
##################################################

multiballs:
  final_multiball:
    ball_count: 5
    ball_count_type: total
    shoot_again: 30000 + current_player.v_finalbattle_ball_save_extention
    start_events: cmd_finalbattle_start_final_multiball
    add_a_ball_events: cmd_finalbattle_add_a_ball

##################################################
# Sites and Sounds
##################################################

slides:

  finalbattle_intro_slide:
    widgets:
      - type: image
        image: final_massacre_intro_v4

  finalbattle_collect_weapons_slide:
    widgets:
      - type: text
        text: (player|score)
        number_grouping: true
        style: small
        round_anchor_x: left
        anchor_x: middle
        anchor_y: bottom
        x: 50%
        y: 2
      - type: image
        image: fb_gather_weapons_v2

  finalbattle_collect_axe_slide:
    widgets:
      - type: image
        image: fb_axe_v1

  finalbattle_collect_shotgun_slide:
    widgets:
      - type: image
        image: fb_shotgun_v1

  finalbattle_collect_nunchucks_slide:
    widgets:
      - type: image
        image: fb_nunchucks_v1

  finalbattle_collect_flamethrower_slide:
    widgets:
      - type: image
        image: fb_flamethrower_v1

  finalbattle_collect_chainsaw_slide:
    widgets:
      - type: image
        image: fb_chainsaw_v1

  finalbattle_collect_knife_slide:
    widgets:
      - type: image
        image: fb_knife_v1


  ## collection bonus slide ##

  finalbattle_bonus_intro_slide:
    widgets:
    - type: image
      image: fb_collected_intro_v1

  finalbattle_bonus_flamethrower_slide:
    widgets:
    - type: image
      image: fb_weapon_flamethrower_v1

  finalbattle_bonus_axe_slide:
    widgets:
    - type: image
      image: fb_collected_axe_v1

  finalbattle_bonus_chainsaw_slide:
    widgets:
    - type: image
      image: fb_collected_chainsaw_v1

  finalbattle_bonus_knife_slide:
    widgets:
    - type: image
      image: fb_collected_knife_v1

  finalbattle_bonus_shotgun_slide:
    widgets:
    - type: image
      image: fb_collected_shotgun_v1

  finalbattle_bonus_nunchucks_slide:
    widgets:
    - type: image
      image: fb_collected_nunchucks_v1

  finalbattle_bonus_fully_loaded_slide:
    widgets:
    - type: image
      image: fb_collected_fully_loaded_v1

  finalbattle_bonus_nothing_slide:
    widgets:
    - type: image
      image: fb_collected_nothing_v1

  finalbattle_multiball_intro_slide:
    widgets:
    - type: image
      image: fb_fight_intro_v1

  ## finalbattle slides ##

  # Sawyer Slides

  finalbattle_sawyer_final_blow:
    widgets:
    - type: image
      image: fb_sawyer_shoot_to_kill_v1

  finallbattle_sawyer_fight:
    widgets:
    - type: text
      text: KILL SAWYER
      style: small
      round_anchor_x: left
      anchor_x: middle
      anchor_y: top
      y: 31
      x: 50%
      animations:
        show_slide:
          - property: opacity
            value: 1
            duration: 0.4s
          - property: opacity
            value: 0
            duration: 0.4s
            repeat: true
    - type: text
      text: (player|score)
      number_grouping: true
      style: small
      round_anchor_x: left
      round_anchor_y: top
      anchor_x: middle
      anchor_y: bottom
      y: 2
      x: 50%
    - type: image
      image: fb_fight_sally_v1
      anchor_x: 0
      anchor_y: 0
      x: 88
      y: 0
    - type: image
      image: fb_fight_sawyer_v1
      anchor_x: 0
      anchor_y: 0
      x: -10
      y: 0
      animations:
        player_v_finalbattle_sawyer_width:
          - property: opacity
            value: 0
            duration: 0s
          - property: opacity
            value: 0
            duration: 0.4s
          - property: opacity
            value: 1
            duration: 0s
    - type: image
      image: fb_fight_sawyer_wince_v1
      anchor_x: 0
      anchor_y: 0
      x: -10
      y: 0
      animations:
        player_v_finalbattle_sawyer_width:
          - property: x
            value: -30
            duration: 0s
          - property: x
            value: -10
            duration: 0.4s
    - type: rectangle
      color: white
      anchor_x: 0
      anchor_y: 0
      x: 39
      y: 14
      z: 500
      width: 0
      height: 5
      animations:
        player_v_finalbattle_sawyer_width:
          - property: width
            value: (value)
            duration: 0.2s
    - type: rectangle
      color: black
      anchor_x: 0
      anchor_y: 0
      x: 41
      y: 15
      width: 46
      height: 3
    - type: rectangle
      color: white
      anchor_x: 0
      anchor_y: 0
      x: 39
      y: 14
      width: 50
      height: 5

  finalbattle_sawyer_death:
    widgets:
    - type: image
      image: fb_sawyer_death_knife_v2

  # grandpa Slides

  finalbattle_grandpa_final_blow:
    widgets:
    - type: image
      image: fb_grandpa_shoot_to_kill_v1

  finallbattle_grandpa_fight:
    widgets:
    - type: text
      text: KILL grandpa
      style: small
      round_anchor_x: left
      anchor_x: middle
      anchor_y: top
      y: 31
      x: 50%
      animations:
        show_slide:
          - property: opacity
            value: 1
            duration: 0.4s
          - property: opacity
            value: 0
            duration: 0.4s
            repeat: true
    - type: text
      text: (player|score)
      number_grouping: true
      style: small
      round_anchor_x: left
      round_anchor_y: top
      anchor_x: middle
      anchor_y: bottom
      y: 2
      x: 50%
    - type: image
      image: fb_fight_sally_v1
      anchor_x: 0
      anchor_y: 0
      x: 88
      y: 0
    - type: image
      image: fb_fight_grandpa_v1
      anchor_x: 0
      anchor_y: 0
      x: -10
      y: 0
      animations:
        player_v_finalbattle_grandpa_width:
          - property: opacity
            value: 0
            duration: 0s
          - property: opacity
            value: 0
            duration: 0.4s
          - property: opacity
            value: 1
            duration: 0s
    - type: image
      image: fb_fight_grandpa_wince_v1
      anchor_x: 0
      anchor_y: 0
      x: -10
      y: 0
      animations:
        player_v_finalbattle_grandpa_width:
          - property: x
            value: -30
            duration: 0s
          - property: x
            value: -10
            duration: 0.4s
    - type: rectangle
      color: white
      anchor_x: 0
      anchor_y: 0
      x: 39
      y: 14
      z: 500
      width: 0
      height: 5
      animations:
        player_v_finalbattle_grandpa_width:
          - property: width
            value: (value)
            duration: 0.2s
    - type: rectangle
      color: black
      anchor_x: 0
      anchor_y: 0
      x: 41
      y: 15
      width: 46
      height: 3
    - type: rectangle
      color: white
      anchor_x: 0
      anchor_y: 0
      x: 39
      y: 14
      width: 50
      height: 5

  finalbattle_grandpa_death:
    widgets:
    - type: image
      image: fb_grandpa_dead_v1

  # hitchhiker Slides

  finalbattle_hitchhiker_final_blow:
    widgets:
    - type: image
      image: fb_hitchhiker_shoot_to_kill_v1

  finallbattle_hitchhiker_fight:
    widgets:
    - type: text
      text: KILL hitchhiker
      style: small
      round_anchor_x: left
      anchor_x: middle
      anchor_y: top
      y: 31
      x: 50%
      animations:
        show_slide:
          - property: opacity
            value: 1
            duration: 0.4s
          - property: opacity
            value: 0
            duration: 0.4s
            repeat: true
    - type: text
      text: (player|score)
      number_grouping: true
      style: small
      round_anchor_x: left
      round_anchor_y: top
      anchor_x: middle
      anchor_y: bottom
      y: 2
      x: 50%
    - type: image
      image: fb_fight_sally_v1
      anchor_x: 0
      anchor_y: 0
      x: 88
      y: 0
    - type: image
      image: fb_fight_hitchhiker_v1
      anchor_x: 0
      anchor_y: 0
      x: -10
      y: 0
      animations:
        player_v_finalbattle_hitchhiker_width:
          - property: opacity
            value: 0
            duration: 0s
          - property: opacity
            value: 0
            duration: 0.4s
          - property: opacity
            value: 1
            duration: 0s
    - type: image
      image: fb_wince_hitchhiker_v1
      anchor_x: 0
      anchor_y: 0
      x: -10
      y: 0
      animations:
        player_v_finalbattle_hitchhiker_width:
          - property: x
            value: -30
            duration: 0s
          - property: x
            value: -10
            duration: 0.4s
    - type: rectangle
      color: white
      anchor_x: 0
      anchor_y: 0
      x: 39
      y: 14
      z: 500
      width: 0
      height: 5
      animations:
        player_v_finalbattle_hitchhiker_width:
          - property: width
            value: (value)
            duration: 0.2s
    - type: rectangle
      color: black
      anchor_x: 0
      anchor_y: 0
      x: 41
      y: 15
      width: 46
      height: 3
    - type: rectangle
      color: white
      anchor_x: 0
      anchor_y: 0
      x: 39
      y: 14
      width: 50
      height: 5

  finalbattle_hitchhiker_death:
    widgets:
    - type: image
      image: fb_hitchhiker_dead_v2

  # leatherface Slides

  finalbattle_leatherface_final_blow:
    widgets:
    - type: image
      image: fb_leatherface_shoot_to_kill_v1

  finallbattle_leatherface_fight:
    widgets:
    - type: text
      text: KILL leatherface
      style: small
      round_anchor_x: left
      anchor_x: middle
      anchor_y: top
      y: 31
      x: 50%
      animations:
        show_slide:
          - property: opacity
            value: 1
            duration: 0.4s
          - property: opacity
            value: 0
            duration: 0.4s
            repeat: true
    - type: text
      text: (player|score)
      number_grouping: true
      style: small
      round_anchor_x: left
      round_anchor_y: top
      anchor_x: middle
      anchor_y: bottom
      y: 2
      x: 50%
    - type: image
      image: fb_fight_sally_v1
      anchor_x: 0
      anchor_y: 0
      x: 88
      y: 0
    - type: image
      image: fb_fight_leatherface_v1
      anchor_x: 0
      anchor_y: 0
      x: -10
      y: 0
      animations:
        player_v_finalbattle_leatherface_width:
          - property: opacity
            value: 0
            duration: 0s
          - property: opacity
            value: 0
            duration: 0.4s
          - property: opacity
            value: 1
            duration: 0s
    - type: image
      image: fb_wince_leatherface_v1
      anchor_x: 0
      anchor_y: 0
      x: -5
      y: 0
      animations:
        player_v_finalbattle_leatherface_width:
          - property: x
            value: -30
            duration: 0s
          - property: x
            value: -10
            duration: 0.4s
    - type: rectangle
      color: white
      anchor_x: 0
      anchor_y: 0
      x: 39
      y: 14
      z: 500
      width: 0
      height: 5
      animations:
        player_v_finalbattle_leatherface_width:
          - property: width
            value: (value)
            duration: 0.2s
    - type: rectangle
      color: black
      anchor_x: 0
      anchor_y: 0
      x: 41
      y: 15
      width: 46
      height: 3
    - type: rectangle
      color: white
      anchor_x: 0
      anchor_y: 0
      x: 39
      y: 14
      width: 50
      height: 5

  finalbattle_leatherface_roaming:
    widgets:
      - type: image
        image: fb_sally_chasing_leatherface_v1

  finalbattle_leatherface_death:
    widgets:
    - type: image
      image: fb_leatherface_dead_v1


slide_player:

  cmd_finalbattle_start_intro_slide:
    finalbattle_intro_slide:
      priority: 300
      # Sean : re-add this
      #expire: 33.7s
      expire: 2s

  # weapon collection slides

  cmd_finalbattle_start_collect_weapons_slide:
    finalbattle_collect_weapons_slide:
      priority: 300

  cmd_remove_finalbattle_start_collect_weapons_slide:
    finalbattle_collect_weapons_slide:
      action: remove

  cmd_finalbattle_start_axe_collect_slide:
    finalbattle_collect_axe_slide:
      priority: 1000
      expire: 3s

  cmd_finalbattle_start_knife_collect_slide:
    finalbattle_collect_knife_slide:
      priority: 1000
      expire: 3s

  cmd_finalbattle_start_chainsaw_collect_slide:
    finalbattle_collect_chainsaw_slide:
      priority: 1000
      expire: 3s

  cmd_finalbattle_start_flamethrower_collect_slide:
    finalbattle_collect_flamethrower_slide:
      priority: 1000
      expire: 3s

  cmd_finalbattle_start_nunchucks_collect_slide:
    finalbattle_collect_nunchucks_slide:
      priority: 1000
      expire: 3s

  cmd_finalbattle_start_shotgun_collect_slide:
    finalbattle_collect_shotgun_slide:
      priority: 1000
      expire: 3s

  # bonus slides

  cmd_finalbattle_bonus_intro_slide:
    finalbattle_bonus_intro_slide:
      priority: 100000
      transition:
        type: push
        duration: 0.5s
        direction: up

  cmd_remove_finalbattle_bonus_intro_slide:
    finalbattle_bonus_intro_slide:
      action: remove

  cmd_finalbattle_bonus_flamethrower_slide:
    finalbattle_bonus_flamethrower_slide:
      priority: 100000
      expire: 3s
      transition:
        type: push
        duration: 0.5s
        direction: up

  cmd_finalbattle_bonus_axe_slide:
    finalbattle_bonus_axe_slide:
      priority: 100000
      expire: 3s
      transition:
        type: push
        duration: 0.5s
        direction: up

  cmd_finalbattle_bonus_nunchucks_slide:
    finalbattle_bonus_nunchucks_slide:
      priority: 100000
      expire: 3s
      transition:
        type: push
        duration: 0.5s
        direction: up

  cmd_finalbattle_bonus_chainsaw_slide:
    finalbattle_bonus_chainsaw_slide:
      priority: 100000
      expire: 3s
      transition:
        type: push
        duration: 0.5s
        direction: up

  cmd_finalbattle_bonus_knife_slide:
    finalbattle_bonus_knife_slide:
      priority: 100000
      expire: 3s
      transition:
        type: push
        duration: 0.5s
        direction: up

  cmd_finalbattle_bonus_shotgun_slide:
    finalbattle_bonus_shotgun_slide:
      priority: 100000
      expire: 3s
      transition:
        type: push
        duration: 0.5s
        direction: up

  cmd_finalbattle_bonus_fully_loaded_slide:
    finalbattle_bonus_fully_loaded_slide:
      priority: 100000
      expire: 3s
      transition:
        type: push
        duration: 0.5s
        direction: up

  cmd_finalbattle_bonus_nothing_slide:
    finalbattle_bonus_nothing_slide:
      priority: 100000
      expire: 3s
      transition:
        type: push
        duration: 0.5s
        direction: up

  cmd_finalbattle_start_multiball_intro_slide:
    finalbattle_multiball_intro_slide:
      priority: 100000
      expire: 10.2s

  # sawyer slide player

  cmd_show_sawyer_slide:
    finallbattle_sawyer_fight:
      priority: 40000

  cmd_remove_sawyer_slide:
    finallbattle_sawyer_fight:
      action: remove

  cmd_show_sawyer_final_blow_slide:
    finalbattle_sawyer_final_blow:
      priority: 40000

  cmd_remove_sawyer_final_blow_slide:
    finalbattle_sawyer_final_blow:
      action: remove

  cmd_show_sawyer_death_slide:
    finalbattle_sawyer_death:
      priority: 40000
      expire: 5s

  # grandpa slide player

  cmd_show_grandpa_slide:
    finallbattle_grandpa_fight:
      priority: 40000

  cmd_remove_grandpa_slide:
    finallbattle_grandpa_fight:
      action: remove

  cmd_show_grandpa_final_blow_slide:
    finalbattle_grandpa_final_blow:
      priority: 40000

  cmd_remove_grandpa_final_blow_slide:
    finalbattle_grandpa_final_blow:
      action: remove

  cmd_show_grandpa_death_slide:
    finalbattle_grandpa_death:
      priority: 40000
      expire: 5s

  # hitchhiker slide player

  cmd_show_hitchhiker_slide:
    finallbattle_hitchhiker_fight:
      priority: 40000

  cmd_remove_hitchhiker_slide:
    finallbattle_hitchhiker_fight:
      action: remove

  cmd_show_hitchhiker_final_blow_slide:
    finalbattle_hitchhiker_final_blow:
      priority: 40000

  cmd_remove_hitchhiker_final_blow_slide:
    finalbattle_hitchhiker_final_blow:
      action: remove

  cmd_show_hitchhiker_death_slide:
    finalbattle_hitchhiker_death:
      priority: 40000
      expire: 4.5s

  # leatherface slide player

  cmd_show_leatherface_slide:
    finallbattle_leatherface_fight:
      priority: 40000

  cmd_remove_leatherface_slide:
    finallbattle_leatherface_fight:
      action: remove

  cmd_show_leatherface_roaming:
    finalbattle_leatherface_roaming:
      priority: 40000

  cmd_remove_leatherface_roaming:
    finalbattle_leatherface_roaming:
      action: remove

  cmd_show_leatherface_final_blow_slide:
    finalbattle_leatherface_final_blow:
      priority: 40000

  cmd_remove_leatherface_final_blow_slide:
    finalbattle_leatherface_final_blow:
      action: remove

  cmd_show_leatherface_death_slide:
    finalbattle_leatherface_death:
      priority: 40000
      expire: 13.4s

sound_player:

  cmd_finalbattle_start_intro_slide_sound:
    final_massacre_intro_v4_score:
      action: play
      loops: 0
      events_when_about_to_finish: cmd_eject_van_vuk_with_audio
      about_to_finish_time: 2s

  cmd_play_finalbattle_bg_music_phase_1:
    finalbattle_bg_music:
      action: play
      loops: -1

  cmd_stop_finalbattle_music_phase_1:
    finalbattle_bg_music:
      action: stop

  cmd_finalbattle_play_knife_collect_sound:
    fb_knife_v1_SFX:
      action: play
      loops: 0

  cmd_finalbattle_play_nunchucks_collect_sound:
    fb_nunchucks_v1_SFX:
      action: play
      loops: 0

  cmd_finalbattle_play_axe_collect_sound:
    fb_axe_v1_SFX:
      action: play
      loops: 0

  cmd_finalbattle_play_shotgun_collect_sound:
    fb_shotgun_v1_SFX:
      action: play
      loops: 0

  cmd_finalbattle_play_flamethrower_collect_sound:
    fb_flamethrower_v1_SFX:
      action: play
      loops: 0

  cmd_finalbattle_play_chainsaw_collect_sound:
    fb_chainsaw_v1_SFX:
      action: play
      loops: 0

  player_finalbattle_finalbattle_phase_1_timer_tick{value == 3}:
    FB_dramatic_swell:
      action: play
      loops: 0

  cmd_finalbattle_play_bass_hit:
    FB_bass_hit:
      action: play
      loops: 0

  cmd_finalbattle_play_bonus_bg:
    FB_weapons_count_music_v1:
      action: play
      loops: 0

  # Hit sounds

  cmd_finalbattle_play_hit_sound_sawyer:
    fb_hit_sound_sawyer:
      action: play
      loops: 0

  cmd_finalbattle_play_hit_sound_hitchhiker:
    fb_hit_sound_hitchhiker:
      action: play
      loops: 0

  cmd_finalbattle_play_hit_sound_grandpa:
    fb_hit_sound_grandpa:
      action: play
      loops: 0

  cmd_finalbattle_play_hit_sound_leatherface:
    fb_hit_sound_leatherface:
      action: play
      loops: 0

  # Death sounds

  cmd_finalbattle_play_death_sound_sawyer:
    sawyer_death_v2_sfx:
      action: play
      loops: 0

  cmd_finalbattle_play_death_sound_hitchhiker:
    hitchhiker_death_v2_sfx:
      action: play
      loops: 0

  cmd_finalbattle_play_death_sound_grandpa:
    hitchhiker_death_v2_sfx:
      action: play
      loops: 0

  cmd_finalbattle_play_death_sound_leatherface:
    hitchhiker_death_v2_sfx:
      action: play
      loops: 0

show_player:

  ### ball save ###

  ball_save_finalbattle_phase_1_gimme_enabled:
    med_flash:
      action: play
      show_tokens:
        light: l_shoot_again

  ball_save_finalbattle_phase_1_disabled:
    med_flash:
      action: stop
      show_tokens:
        light: l_shoot_again

  ###################################################
  # Lights
  ###################################################

  # Lights
  # left_orbit_arrow: knife
  # captive_ball_arrow: nunchucks
  # basket_ramp_arrow: axe
  # slaughter_house_arrow: shotgun
  # right_ramp_arrow: flamethrower
  # right_orbit_arrow: chainsaw

  # Lights off

  cmd_finalbattle_refresh_lights.999999991:
    med_flash_knife:
      action: stop
      show_tokens:
        lights: left_orbit_arrow

  cmd_finalbattle_refresh_lights.999999992:
    med_flash_nunchucks:
      action: stop
      show_tokens:
        lights: captive_ball_arrow

  cmd_finalbattle_refresh_lights.999999993:
    med_flash_axe:
      action: stop
      show_tokens:
        lights: basket_ramp_arrow

  cmd_finalbattle_refresh_lights.999999994:
    med_flash_shotgun:
      action: stop
      show_tokens:
        lights: slaughter_house_arrow

  cmd_finalbattle_refresh_lights.999999995:
    med_flash_flamethrower:
      action: stop
      show_tokens:
        lights: right_ramp_arrow

  cmd_finalbattle_refresh_lights.999999996:
    med_flash_chainsaw:
      action: stop
      show_tokens:
        lights: right_orbit_arrow

  cmd_finalbattle_refresh_lights.999999997:
    med_flash_chainsaw:
      action: stop
      show_tokens:
        lights: basket_ramp_arrow

  cmd_finalbattle_refresh_lights.999999998:
    med_flash_final_blow:
      action: stop
      show_tokens:
        lights: super_duper_jackpot

  cmd_finalbattle_refresh_lights.999999999:
    med_flash_final_blow:
      action: stop
      show_tokens:
        lights: van

  # phase 1

  cmd_finalbattle_refresh_lights.1{current_player.v_finalbattle_state=="phase_1" and current_player.v_finalbattle_knife_collected==0}:
    med_flash_knife:
      action: play
      show_tokens:
        lights: left_orbit_arrow

  cmd_finalbattle_refresh_lights.3{current_player.v_finalbattle_state=="phase_1" and current_player.v_finalbattle_nunchucks_collected==0}:
    med_flash_nunchucks:
      action: play
      show_tokens:
        lights: captive_ball_arrow

  cmd_finalbattle_refresh_lights.5{current_player.v_finalbattle_state=="phase_1" and current_player.v_finalbattle_axe_collected==0}:
    med_flash_axe:
      action: play
      show_tokens:
        lights: basket_ramp_arrow

  cmd_finalbattle_refresh_lights.7{current_player.v_finalbattle_state=="phase_1" and current_player.v_finalbattle_shotgun_collected==0}:
    med_flash_shotgun:
      action: play
      show_tokens:
        lights: slaughter_house_arrow

  cmd_finalbattle_refresh_lights.9{current_player.v_finalbattle_state=="phase_1" and current_player.v_finalbattle_flamethrower_collected==0}:
    med_flash_flamethrower:
      action: play
      show_tokens:
        lights: right_ramp_arrow

  cmd_finalbattle_refresh_lights.11{current_player.v_finalbattle_state=="phase_1" and current_player.v_finalbattle_chainsaw_collected==0}:
    med_flash_chainsaw:
      action: play
      show_tokens:
        lights: right_orbit_arrow


  ## Sawyer fight

  cmd_finalbattle_refresh_lights.23{current_player.v_finalbattle_state=="multiball_sawyer"}:
    med_flash_knife:
      action: play
      show_tokens:
        lights: left_orbit_arrow

  cmd_finalbattle_refresh_lights.24{current_player.v_finalbattle_state=="multiball_sawyer"}:
    med_flash_nunchucks:
      action: play
      show_tokens:
        lights: captive_ball_arrow

  cmd_finalbattle_refresh_lights.19{current_player.v_finalbattle_state=="multiball_sawyer"}:
    med_flash_axe:
      action: play
      show_tokens:
        lights: basket_ramp_arrow

  cmd_finalbattle_refresh_lights.20{current_player.v_finalbattle_state=="multiball_sawyer"}:
    med_flash_shotgun:
      action: play
      show_tokens:
        lights: slaughter_house_arrow

  cmd_finalbattle_refresh_lights.21{current_player.v_finalbattle_state=="multiball_sawyer"}:
    med_flash_flamethrower:
      action: play
      show_tokens:
        lights: right_ramp_arrow

  cmd_finalbattle_refresh_lights.22{current_player.v_finalbattle_state=="multiball_sawyer"}:
    med_flash_chainsaw:
      action: play
      show_tokens:
        lights: right_orbit_arrow

  # Sawyer final blow

  cmd_finalbattle_refresh_lights.25{current_player.v_finalbattle_state=="sawyer_final_blow"}:
    med_flash_final_blow:
      action: play
      show_tokens:
        lights: super_duper_jackpot

  ## grandpa fight

  cmd_finalbattle_refresh_lights.23{current_player.v_finalbattle_state=="multiball_grandpa" and current_player.v_finalbattle_combo_left_orbit!=1}:
    med_flash_knife:
      action: play
      show_tokens:
        lights: left_orbit_arrow

  cmd_finalbattle_refresh_lights.24{current_player.v_finalbattle_state=="multiball_grandpa" and current_player.v_finalbattle_combo_captive!=1}:
    med_flash_nunchucks:
      action: play
      show_tokens:
        lights: captive_ball_arrow

  cmd_finalbattle_refresh_lights.19{current_player.v_finalbattle_state=="multiball_grandpa" and current_player.v_finalbattle_combo_left_ramp!=1}:
    med_flash_axe:
      action: play
      show_tokens:
        lights: basket_ramp_arrow

  cmd_finalbattle_refresh_lights.20{current_player.v_finalbattle_state=="multiball_grandpa" and current_player.v_finalbattle_combo_slaughter!=1}:
    med_flash_shotgun:
      action: play
      show_tokens:
        lights: slaughter_house_arrow

  cmd_finalbattle_refresh_lights.21{current_player.v_finalbattle_state=="multiball_grandpa" and current_player.v_finalbattle_combo_right_ramp!=1}:
    med_flash_flamethrower:
      action: play
      show_tokens:
        lights: right_ramp_arrow

  cmd_finalbattle_refresh_lights.22{current_player.v_finalbattle_state=="multiball_grandpa" and current_player.v_finalbattle_combo_right_orbit!=1}:
    med_flash_chainsaw:
      action: play
      show_tokens:
        lights: right_orbit_arrow

  # grandpa final blow

  cmd_finalbattle_refresh_lights.25{current_player.v_finalbattle_state=="grandpa_final_blow"}:
    med_flash_final_blow:
      action: play
      show_tokens:
        lights: super_duper_jackpot

  ## hitchhiker fight

  cmd_finalbattle_refresh_lights.23{current_player.v_finalbattle_state=="multiball_hitchhiker" and current_player.v_finalbattle_combo_left_orbit!=1}:
    med_flash_knife:
      action: play
      show_tokens:
        lights: left_orbit_arrow

  cmd_finalbattle_refresh_lights.24{current_player.v_finalbattle_state=="multiball_hitchhiker" and current_player.v_finalbattle_combo_captive!=1}:
    med_flash_nunchucks:
      action: play
      show_tokens:
        lights: captive_ball_arrow

  cmd_finalbattle_refresh_lights.19{current_player.v_finalbattle_state=="multiball_hitchhiker" and current_player.v_finalbattle_combo_left_ramp!=1}:
    med_flash_axe:
      action: play
      show_tokens:
        lights: basket_ramp_arrow

  cmd_finalbattle_refresh_lights.20{current_player.v_finalbattle_state=="multiball_hitchhiker" and current_player.v_finalbattle_combo_slaughter!=1}:
    med_flash_shotgun:
      action: play
      show_tokens:
        lights: slaughter_house_arrow

  cmd_finalbattle_refresh_lights.21{current_player.v_finalbattle_state=="multiball_hitchhiker" and current_player.v_finalbattle_combo_right_ramp!=1}:
    med_flash_flamethrower:
      action: play
      show_tokens:
        lights: right_ramp_arrow

  cmd_finalbattle_refresh_lights.22{current_player.v_finalbattle_state=="multiball_hitchhiker" and current_player.v_finalbattle_combo_right_orbit!=1}:
    med_flash_chainsaw:
      action: play
      show_tokens:
        lights: right_orbit_arrow

  # hitchhiker final blow

  cmd_finalbattle_refresh_lights.25{current_player.v_finalbattle_state=="hitchhiker_final_blow"}:
    med_flash_final_blow:
      action: play
      show_tokens:
        lights: super_duper_jackpot

  ## leatherface fight

  cmd_finalbattle_refresh_lights.23{current_player.v_finalbattle_state=="multiball_leatherface" and current_player.v_finalbattle_combo_left_orbit!=1}:
    med_flash_knife:
      action: play
      show_tokens:
        lights: left_orbit_arrow

  cmd_finalbattle_refresh_lights.24{current_player.v_finalbattle_state=="multiball_leatherface" and current_player.v_finalbattle_combo_captive!=1}:
    med_flash_nunchucks:
      action: play
      show_tokens:
        lights: captive_ball_arrow

  cmd_finalbattle_refresh_lights.19{current_player.v_finalbattle_state=="multiball_leatherface" and current_player.v_finalbattle_combo_left_ramp!=1}:
    med_flash_axe:
      action: play
      show_tokens:
        lights: basket_ramp_arrow

  cmd_finalbattle_refresh_lights.20{current_player.v_finalbattle_state=="multiball_leatherface" and current_player.v_finalbattle_combo_slaughter!=1}:
    med_flash_shotgun:
      action: play
      show_tokens:
        lights: slaughter_house_arrow

  cmd_finalbattle_refresh_lights.21{current_player.v_finalbattle_state=="multiball_leatherface" and current_player.v_finalbattle_combo_right_ramp!=1}:
    med_flash_flamethrower:
      action: play
      show_tokens:
        lights: right_ramp_arrow

  cmd_finalbattle_refresh_lights.22{current_player.v_finalbattle_state=="multiball_leatherface" and current_player.v_finalbattle_combo_right_orbit!=1}:
    med_flash_chainsaw:
      action: play
      show_tokens:
        lights: right_orbit_arrow

  # leatherface roaming

  cmd_finalbattle_refresh_lights.23{current_player.v_finalbattle_state=="leatherface_roaming" and current_player.v_finalbattle_leatherface_roaming_shot=="left_orbit"}:
    med_flash_knife:
      action: play
      show_tokens:
        lights: left_orbit_arrow

  cmd_finalbattle_refresh_lights.24{current_player.v_finalbattle_state=="leatherface_roaming" and current_player.v_finalbattle_leatherface_roaming_shot=="captive"}:
    med_flash_nunchucks:
      action: play
      show_tokens:
        lights: captive_ball_arrow

  cmd_finalbattle_refresh_lights.19{current_player.v_finalbattle_state=="leatherface_roaming" and current_player.v_finalbattle_leatherface_roaming_shot=="left_ramp"}:
    med_flash_axe:
      action: play
      show_tokens:
        lights: basket_ramp_arrow

  cmd_finalbattle_refresh_lights.20{current_player.v_finalbattle_state=="leatherface_roaming" and current_player.v_finalbattle_leatherface_roaming_shot=="slaughter"}:
    med_flash_shotgun:
      action: play
      show_tokens:
        lights: slaughter_house_arrow

  cmd_finalbattle_refresh_lights.21{current_player.v_finalbattle_state=="leatherface_roaming" and current_player.v_finalbattle_leatherface_roaming_shot=="right_ramp"}:
    med_flash_flamethrower:
      action: play
      show_tokens:
        lights: right_ramp_arrow

  cmd_finalbattle_refresh_lights.22{current_player.v_finalbattle_state=="leatherface_roaming" and current_player.v_finalbattle_leatherface_roaming_shot=="right_orbit"}:
    med_flash_chainsaw:
      action: play
      show_tokens:
        lights: right_orbit_arrow


  # leatherface final blow

  cmd_finalbattle_refresh_lights.25{current_player.v_finalbattle_state=="leatherface_final_blow"}:
    med_flash_final_blow:
      action: play
      show_tokens:
        lights: van

shows:
  med_flash_knife:
    - duration: 0.5
      lights:
        (light):
          color: on
        (lights):
          color: on
        (led):
          color: on
        (leds):
          color: on
    - duration: 0.5
      lights:
        (light):
          color: off
        (lights):
          color: off
        (led):
          color: off
        (leds):
          color: off

  med_flash_nunchucks:
    - duration: 0.5
      lights:
        (light):
          color: on
        (lights):
          color: on
        (led):
          color: on
        (leds):
          color: on
    - duration: 0.5
      lights:
        (light):
          color: off
        (lights):
          color: off
        (led):
          color: off
        (leds):
          color: off

  med_flash_axe:
    - duration: 0.5
      lights:
        (light):
          color: on
        (lights):
          color: on
        (led):
          color: on
        (leds):
          color: on
    - duration: 0.5
      lights:
        (light):
          color: off
        (lights):
          color: off
        (led):
          color: off
        (leds):
          color: off

  med_flash_shotgun:
    - duration: 0.5
      lights:
        (light):
          color: on
        (lights):
          color: on
        (led):
          color: on
        (leds):
          color: on
    - duration: 0.5
      lights:
        (light):
          color: off
        (lights):
          color: off
        (led):
          color: off
        (leds):
          color: off

  med_flash_flamethrower:
    - duration: 0.5
      lights:
        (light):
          color: on
        (lights):
          color: on
        (led):
          color: on
        (leds):
          color: on
    - duration: 0.5
      lights:
        (light):
          color: off
        (lights):
          color: off
        (led):
          color: off
        (leds):
          color: off

  med_flash_chainsaw:
    - duration: 0.5
      lights:
        (light):
          color: on
        (lights):
          color: on
        (led):
          color: on
        (leds):
          color: on
    - duration: 0.5
      lights:
        (light):
          color: off
        (lights):
          color: off
        (led):
          color: off
        (leds):
          color: off

  med_flash_final_blow:
    - duration: 0.5
      lights:
        (light):
          color: on
        (lights):
          color: on
        (led):
          color: on
        (leds):
          color: on
    - duration: 0.5
      lights:
        (light):
          color: off
        (lights):
          color: off
        (led):
          color: off
        (leds):
          color: off
